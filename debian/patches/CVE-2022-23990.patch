From: Markus Koschany <apo@debian.org>
Date: Mon, 31 Jan 2022 17:09:59 +0100
Subject: CVE-2022-23990

---
 lib/xmlparse.c | 11 +++++++++--
 1 file changed, 9 insertions(+), 2 deletions(-)

diff --git a/lib/xmlparse.c b/lib/xmlparse.c
index 6ba99ee..c30ddf7 100644
--- a/lib/xmlparse.c
+++ b/lib/xmlparse.c
@@ -4822,7 +4822,7 @@ doProlog(XML_Parser parser,
       if (dtd->in_eldecl) {
         ELEMENT_TYPE *el;
         const XML_Char *name;
-        int nameLen;
+        size_t nameLen;
         const char *nxt = (quant == XML_CQUANT_NONE
                            ? next
                            : next - enc->minBytesPerChar);
@@ -4838,7 +4838,14 @@ doProlog(XML_Parser parser,
         dtd->scaffold[myindex].name = name;
         nameLen = 0;
         for (; name[nameLen++]; );
-        dtd->contentStringLen +=  nameLen;
+
+        /* Detect and prevent integer overflow */
+        if (nameLen > UINT_MAX - dtd->contentStringLen) {
+          return XML_ERROR_NO_MEMORY;
+        }
+
+        dtd->contentStringLen += (unsigned)nameLen;
+
         if (elementDeclHandler)
           handleDefault = XML_FALSE;
       }
